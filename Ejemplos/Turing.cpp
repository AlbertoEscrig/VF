// =================================================================================================
// ====================================================================================== Turing.cpp
//
// Modelo de reacción-difusión de Gray y Scott
//
// ================================================================= Copyright © 2025 Alberto Escrig
// =================================================================================================

import VF;
import std;

// -------------------------------------------------------------------------------------- Constantes

constexpr double Du = 2e-5,
                 Dv = 1e-5,
                 f  = 0.0367,
                 k  = 0.0649;

constexpr double Δt      = 1.0,
                 ΔtWrite = 500.0,
                 tFin    = 30'000.0;

int main()
{
// ------------------------------------------------------------------------------------------- Malla

VF::TMalla2D::Read("Turing.msh");

// ------------------------------------------------------------------------------------------ Campos

VF::TCampoEscalar2D u,
                    v;

// --------------------------------------------------------------------------- Condiciones iniciales

u.Asigna("rest", 1.0);
u.Asigna("seed", 0.5);

v.Asigna("rest", 0.0);
v.Asigna("seed", 0.25);

for (double t = Δt; t < tFin + Δt; t += Δt)
  {
// ---------------------------------------------------------------------------------------- Solución

  solve(Δ(u) / Δt - Du * lap(u) + v * v * (+u) + f       * (+u) == f, u);

  solve(Δ(v) / Δt - Dv * lap(v) - u * v * (+v) + (f + k) * (+v) == 0, v);

// -------------------------------------------------------------------------------------- Resultados

  if (std::fmod(t, ΔtWrite) < Δt)
    {
    static int i = 0;

    std::ofstream ofs(std::format("resu{:02d}.vtk", i++));

    VF::TMalla2D::Write(ofs);
    u.Write(ofs, "u");
    v.Write(ofs, "v");
    }
  }

return 0;
}
