// =================================================================================================
// ====================================================================================== Turing.cpp
//
// Modelo de reacción-difusión de Gray y Scott
//
// ================================================================= Copyright © 2025 Alberto Escrig
// =================================================================================================

import VF;
import std;

// -------------------------------------------------------------------------------------- Constantes

constexpr double Du = 2e-5,
                 Dv = 1e-5,
                 f  = 0.0367,
                 k  = 0.0649;

constexpr double dt      = 1.0,
                 dtWrite = 500.0,
                 tFin    = 30'000.0;

int main()
{
// ------------------------------------------------------------------------------------------- Malla

VF::TMalla2D::Read("Turing.msh");

// ------------------------------------------------------------------------------------------ Campos

VF::TCampoEscalar2D u,
                    v;

// --------------------------------------------------------------------------- Condiciones iniciales

u.Asigna("rest", 1.0);
u.Asigna("seed", 0.5);

v.Asigna("rest", 0.0);
v.Asigna("seed", 0.25);

for (double t = dt; t < tFin + dt; t += dt)
  {
// ---------------------------------------------------------------------------------------- Solución

  solve(d(u) / dt - Du * lap(u) + v * v * Sp(u) + f       * Sp(u) == f, u);

  solve(d(v) / dt - Dv * lap(v) - u * v * Sp(v) + (f + k) * Sp(v) == 0, v);

// -------------------------------------------------------------------------------------- Resultados

  if (std::fmod(t, dtWrite) < dt)
    {
    static int i = 0;

    std::ofstream ofs(std::format("resu{:02d}.vtk", i++));

    VF::TMalla2D::Write(ofs);
    u.Write(ofs, "u");
    v.Write(ofs, "v");
    }
  }
}
